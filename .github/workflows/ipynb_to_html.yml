name: Build and Deploy Analysis Site

on:
  push:
    branches:
      - main # This workflow runs when you push to the 'main' branch

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Allows the action to push to the deployment branch

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11' # Or your preferred version

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install jupyter pandas numpy scikit-learn plotly

      - name: Run Notebook to Generate HTML Files
        run: |
          # This command executes your notebook. 
          # The Python code inside your notebook creates the `analysis` folder
          # and saves the interactive .html files.
          jupyter nbconvert --to notebook --execute "Model and Visuals.ipynb" --output "Model and Visuals.ipynb"

      - name: Prepare Files for Publishing
        run: |
          # Copy the source notebook and data files into the analysis folder
          # so they are also included in the deployment.
          cp "Model and Visuals.ipynb" analysis/
          cp *.csv analysis/
          # The HTML files should already be in the analysis folder from the previous step.
          # If they are not, you can move them now:
          # mv *.html analysis/

      - name: Deploy to GitHub Pages
        uses: s0/git-publish-subdir-action@develop
        env:
          REPO: self
          BRANCH: build # The branch to deploy TO (e.g., main or gh-pages)
          FOLDER: analysis # The folder to deploy FROM
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}